// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model User {
    id                 String          @id @default(uuid())
    email              String          @unique @db.VarChar(100)
    firstname          String          @db.VarChar(100)
    lastname           String          @db.VarChar(100)
    password           String          @db.VarChar(100)
    Education          Education[]
    Hobby              Hobby[]
    Skill              Skill[]
    Married_goal       MarriedGoal[]
    Life_goal          LifeGoal[]
    active             Boolean         @default(false)
    verified           Boolean         @default(false)
    avatar             String?         @db.VarChar(255)
    avatar_md          String?         @db.VarChar(255)
    blurred_avatar     String?         @db.VarChar(255)
    blurred_avatar_md  String?         @db.VarChar(255)
    role               RoleStatus      @default(MEMBER)
    taaruf_status      TaarufStatus    @default(BLOCKED)
    auth               Auth[]
    Taaruf_gold        Taaruf_gold[]
    Payment            Payment[]
    reset_password     ResetPassword[]
    activations        Activation[]
    biodata            Biodata?
    bookmarks          Bookmark[]      @relation("UserBookmarks")
    bookmark_candidate Bookmark[]      @relation("UserCandidates")
    createdAt          DateTime        @default(now())
    updatedAt          DateTime        @default(now()) @updatedAt
    Taaruf             Taaruf[]        @relation("TaarufUser")
    Taaruf_candidate   Taaruf[]        @relation("TaarufCandidates")

    @@map("user")
}

model Client {
    id                String    @id @default(uuid())
    name              String    @db.VarChar(100)
    about             String?   @db.Text
    phone             String    @db.VarChar(20)
    address           String    @db.Text
    taaruf_muqoddimah String?   @db.Text
    login_muqoddimah  String?   @db.Text
    signup_muqoddimah String?   @db.Text
    youtube           String?   @db.VarChar(100)
    facebook          String?   @db.VarChar(100)
    twitter           String?   @db.VarChar(100)
    tiktok            String?   @db.VarChar(100)
    instagram         String?   @db.VarChar(100)
    linkedin          String?   @db.VarChar(100)
    galleries         Gallery[]
    sliders           Slider[]
    faqs              FAQ[]

    @@map("client")
}

enum RoleStatus {
    MEMBER
    ADMIN
    SUPERADMIN
}

enum TaarufStatus {
    OPEN
    PENDING
    BLOCKED
}

model Auth {
    id           String   @id @default(uuid())
    user         User?    @relation(fields: [userId], references: [id])
    userId       String?
    access_token String   @db.VarChar(300)
    expiredAt    DateTime @default(now())
    path         String   @db.VarChar(100)
    method       String   @db.VarChar(100)
    createdAt    DateTime @default(now())

    @@map("auth")
}

model ResetPassword {
    id        String   @id @default(uuid())
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?
    used      Boolean  @default(false)
    expiredAt DateTime @default(now())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("reset_password")
}

model Gallery {
    id        String   @id @default(uuid())
    Client    Client?  @relation(fields: [clientId], references: [id])
    clientId  String?
    title     String?  @db.VarChar(100)
    photo     String?  @db.Text
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("gallery")
}

model Slider {
    id        String   @id @default(uuid())
    Client    Client?  @relation(fields: [clientId], references: [id])
    clientId  String?
    title     String?  @db.Text
    photo     String?  @db.Text
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("slider")
}

model FAQ {
    id        String   @id @default(uuid())
    Client    Client?  @relation(fields: [clientId], references: [id])
    clientId  String?
    question  String   @db.VarChar(255)
    answer    String   @db.VarChar(255)
    deleted   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("faq")
}

model Activation {
    id        String   @id @default(uuid())
    user      User?    @relation(fields: [userId], references: [id])
    userId    String?
    used      Boolean  @default(false)
    expiredAt DateTime @default(now())
    createdAt DateTime @default(now())

    @@map("activation")
}

model Biodata {
    id                  String             @id @default(uuid())
    user                User?              @relation(fields: [userId], references: [id])
    userId              String?            @unique
    bio                 String             @db.Text
    phone               String             @db.VarChar(20)
    manhaj              ManhajStatus
    gender              Gender
    marriage_status     MarriageStatus
    marriage_permission MarriagePermission
    physical_characters PhysicalCharacter?
    dob                 DateTime           @db.Date
    birth_place         String             @db.VarChar(100)
    birth_order         Int                @db.TinyInt
    domicile_town       String             @db.VarChar(100)
    domicile_province   String             @db.VarChar(100)
    hometown_province   String             @db.VarChar(100)
    ethnic              String             @db.VarChar(100)
    createdAt           DateTime           @default(now())
    updatedAt           DateTime           @default(now()) @updatedAt

    @@map("biodata")
}

enum ManhajStatus {
    SALAF
    BARU_BELAJAR
    NON_SALAF
}

enum Gender {
    PRIA
    WANITA
}

enum MarriageStatus {
    LAJANG
    MENIKAH
    DUDA
    JANDA
}

enum MarriagePermission {
    POLIGAMI
    NON_POLIGAMI
}

model Province {
    id      String  @id @default(uuid())
    name    String  @unique() @db.VarChar(100)
    deleted Boolean @default(false)

    @@map("province")
}

model Education {
    id               String   @id @default(uuid())
    User             User?    @relation(fields: [userId], references: [id])
    userId           String?
    institution_name String   @db.VarChar(100)
    major            String?  @db.VarChar(100)
    degree           String?  @db.VarChar(100)
    city             String?  @db.VarChar(100)
    startYear        Int      @db.Year
    endYear          Int?     @db.Year
    deleted          Boolean  @default(false)
    createdAt        DateTime @default(now())
    updatedAt        DateTime @default(now()) @updatedAt

    @@map("education")
}

model Hobby {
    id        String   @id @default(uuid())
    User      User?    @relation(fields: [userId], references: [id])
    userId    String?
    title     String   @db.VarChar(100)
    deleted   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("hobby")
}

model Skill {
    id        String   @id @default(uuid())
    User      User?    @relation(fields: [userId], references: [id])
    userId    String?
    title     String   @db.VarChar(100)
    deleted   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("skill")
}

model MarriedGoal {
    id        String   @id @default(uuid())
    User      User?    @relation(fields: [userId], references: [id])
    userId    String?
    title     String   @db.VarChar(255)
    deleted   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("married_goal")
}

model LifeGoal {
    id        String   @id @default(uuid())
    User      User?    @relation(fields: [userId], references: [id])
    userId    String?
    title     String   @db.VarChar(255)
    deleted   Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    @@map("life_goal")
}

model PhysicalCharacter {
    id                     String     @id @default(uuid())
    height                 Int        @default(170) @db.Int
    weight                 Int        @default(60) @db.Int
    body_shape             body_shape @default(normal)
    skin_color             skin_color @default(putih)
    hair_color             hair_color @default(hitam)
    hair_type              hair_type  @default(lurus)
    eye_color              eye_Color  @default(coklat)
    characteristic         String?    @db.VarChar(255)
    characteristic_detail  String?    @db.VarChar(255)
    medical_history        String?    @db.VarChar(255)
    medical_history_detail String?    @db.VarChar(255)
    deleted                Boolean    @default(false)
    createdAt              DateTime   @default(now())
    updatedAt              DateTime   @default(now()) @updatedAt
    Biodata                Biodata?   @relation(fields: [biodataId], references: [id])
    biodataId              String?    @unique

    @@map("physical_character")
}

enum body_shape {
    sangat_kurus
    kurus
    atletis
    normal
    gempal
    gemuk
    sangat_gemuk
}

enum skin_color {
    sawo_matang
    putih
    putih_kemerahan
    gelap
    hitam
}

enum hair_color {
    hitam
    pirang
    merah
    putih
}

enum hair_type {
    lurus
    ikal
    keriting
    kribo
    botak
}

enum eye_Color {
    hitam
    coklat
    biru
    hijau
}

model Taaruf_gold {
    id        String    @id @unique @default(uuid())
    user      User?     @relation(fields: [userId], references: [id])
    userId    String
    startedAt DateTime?
    endingAt  DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @default(now()) @updatedAt
    Payment   Payment?
}

model Payment {
    id            String             @id @default(uuid())
    user          User?              @relation(fields: [userId], references: [id])
    userId        String
    gross_amount  Int
    midtransToken String?            @db.VarChar(255)
    status        String             @default("pending")
    paidAt        DateTime?
    midtrans      Midtrans_callback?
    createdAt     DateTime           @default(now())
    updatedAt     DateTime           @default(now()) @updatedAt
    taaruf_gold   Taaruf_gold?       @relation(fields: [taaruf_goldId], references: [id])
    taaruf_goldId String?            @unique
}

model Midtrans_callback {
    id            String   @id @default(uuid())
    payment       Payment? @relation(fields: [paymentId], references: [id])
    paymentId     String   @unique
    callback_data String   @db.LongText
    createdAt     DateTime @default(now())
}

model Bookmark {
    id          String   @id @default(uuid())
    user        User     @relation(name: "UserBookmarks", fields: [userId], references: [id])
    userId      String // This field holds the foreign key
    candidate   User     @relation(name: "UserCandidates", fields: [candidateId], references: [id])
    candidateId String // This field holds the foreign key`
    bookmarked  Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @default(now()) @updatedAt

    @@map("bookmark")
}

// TAARUF PROGGRESS
model Taaruf {
    id          String          @id @default(uuid())
    user        User            @relation(name: "TaarufUser", fields: [userId], references: [id])
    userId      String // This field holds the foreign key
    candidate   User            @relation(name: "TaarufCandidates", fields: [candidateId], references: [id])
    candidateId String // This field holds the foreign key
    status      Boolean         @default(true)
    // message dibutuhkan saat taaruf di batalkan oleh user,
    // user mengisi alasan pembatalan
    message     String          @db.Text
    approval    TaarufApproval?
    nadhars     Nadhar[]
    khitbahs    Khitbah[]
    akads       Akad[]
    createdAt   DateTime        @default(now())
    updatedAt   DateTime        @default(now()) @updatedAt
}

model TaarufApproval {
    id        String        @id @default(uuid())
    taaruf    Taaruf?       @relation(fields: [taarufId], references: [id])
    taarufId  String        @unique
    status    AprovalStatus @default(Pending)
    message   String        @db.Text
    reply     String        @db.Text
    updatedAt DateTime      @default(now()) @updatedAt
}

model Nadhar {
    id        String        @id @default(uuid())
    Taaruf    Taaruf?       @relation(fields: [taarufId], references: [id])
    taarufId  String
    schedule  DateTime      @default(now())
    status    AprovalStatus @default(Pending)
    message   String        @db.Text
    reply     String        @db.Text
    createdAt DateTime      @default(now())
    updatedAt DateTime      @default(now()) @updatedAt
}

model Khitbah {
    id        String        @id @default(uuid())
    Taaruf    Taaruf?       @relation(fields: [taarufId], references: [id])
    taarufId  String
    schedule  DateTime      @default(now())
    status    AprovalStatus @default(Pending)
    message   String        @db.Text
    reply     String        @db.Text
    createdAt DateTime      @default(now())
    updatedAt DateTime      @default(now()) @updatedAt
}

model Akad {
    id        String        @id @default(uuid())
    Taaruf    Taaruf?       @relation(fields: [taarufId], references: [id])
    taarufId  String
    schedule  DateTime      @default(now())
    status    AprovalStatus @default(Pending)
    message   String        @db.Text
    reply     String        @db.Text
    createdAt DateTime      @default(now())
    updatedAt DateTime      @default(now()) @updatedAt
}

enum AprovalStatus {
    Pending
    Yes
    No
}
